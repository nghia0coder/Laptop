@model ProductVariation
@using Microsoft.AspNetCore.Http.Extensions
@{
	string currentUrl = Context.Request.GetDisplayUrl();
	IEnumerable<ProductItem> ListColor = ViewBag.Color ;
	IEnumerable<ProductVariation> ListSP = ViewBag.ListSP as IEnumerable<ProductVariation>;
	IEnumerable<Product> ListSize = ViewBag.ListSizes;
}

@{
	ViewData["Title"] = "Chi Tiết Sản Phẩm";
	Layout = "~/Views/Layout/ProductLayout.cshtml";
}
<!-- SECTION -->
<div class="section">
	<!-- container -->
	<div class="container">
		<!-- row -->
		<div class="row">
			<!-- Product main img -->
			<div class="col-md-5 col-md-push-2">
				<div id="product-main-img">
					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image1" alt="">
					</div>

					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image2" alt="">
					</div>

					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image3" alt="">
					</div>

					<div class="product-preview">
						<img   src="~/Contents/img/@Model.ProductItems.Image4" alt="">
					</div>
				</div>
			</div>
			<!-- /Product main img -->
			<!-- Product thumb imgs -->
			<div class="col-md-2  col-md-pull-5">
				<div id="product-imgs">
					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image1" alt="">
					</div>

					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image2" alt="">
					</div>

					<div class="product-preview">
						<img   src="~/Contents/img/@Model.ProductItems.Image3" alt="">
					</div>

					<div class="product-preview">
						<img  src="~/Contents/img/@Model.ProductItems.Image4" alt="">
					</div>
				</div>
			</div>
			<!-- /Product thumb imgs -->
			<!-- Product details -->
			<div class="col-md-5">
				<div class="product-details">
					<h2 class="product-name">@Model.ProductItems.Product.ProductName.ToUpper() @Model.Ram.RamName.ToUpper() @Model.Ssd.Ssdname</h2>
					<div>
						<div class="product-rating">
							<i class="fa fa-star"></i>	
							<i class="fa fa-star"></i>
							<i class="fa fa-star"></i>
							<i class="fa fa-star"></i>
							<i class="fa fa-star-o"></i>
						</div>
						<a class="review-link" href="#">10 Review(s) | Add your review</a>
					</div>
					<div>
						<h4 class="product-price">@Model.Price <del class="product-old-price">@Model.OriginPrice</del></h4>
						@if (Model.QtyinStock <= 0 || Model.QtyinStock == null)
						{
							<span class="product-available">Out Of Stock</span>
						}
						else
						{
							<span class="product-available">In Stock</span>
						}

					</div>
					<p>@Model.ProductItems.Product.Description</p>

					<div class="product-options">
						<label>
							Color
							<select id="colorId" class="input-select">
							</select>
						</label>				
					</div>
					<div class="product-options">
						<label>
							Quantity In Stock
							<span class="input">@Model.QtyinStock</span>
						</label>
					</div>

					<div class="add-to-cart">
						<div class="qty-label">
							Qty
							<div class="input-number">
								<input type="number" id="quantityInput" value="1"> 
								<button  id="unique-item-qty-up">+</button>
								<span class="qty-down">-</span>
							</div>
						</div>
						@if(Model.QtyinStock > 0)
						{
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
							</div>
						}
						else
						{
							<div class="add-to-cart" style="display: none;">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i></button>
							</div>
						}

					</div>

					<ul class="product-btns">
						<li><a href="#"><i class="fa fa-heart-o"></i> add to wishlist</a></li>
						<li><a href="#"><i class="fa fa-exchange"></i> add to compare</a></li>
					</ul>

					<ul class="product-links">
						<li>Category:</li>
						<li><a href="#">@Model.ProductItems.Product.Category.CategoryName</a></li>
					</ul>

					<ul class="product-links">
						<li>Share:</li>
						<li><a href="#"><i class="fa fa-facebook"></i></a></li>
						<li><a href="#"><i class="fa fa-twitter"></i></a></li>
						<li><a href="#"><i class="fa fa-google-plus"></i></a></li>
						<li><a href="#"><i class="fa fa-envelope"></i></a></li>
					</ul>

				</div>
			</div>
			<!-- /Product details -->
			<!-- Product tab -->
			<div class="col-md-12">
				<div id="product-tab">
					<!-- product tab nav -->
					<ul class="tab-nav">
						<li class="active"><a data-toggle="tab" href="#tab1">Description</a></li>
						<li><a data-toggle="tab" href="#tab2">Details</a></li>
						<li><a data-toggle="tab" href="#tab3">Reviews (3)</a></li>
					</ul>
					<!-- /product tab nav -->
					<!-- product tab content -->
					<div class="tab-content">
						<!-- tab1  -->
						<div id="tab1" class="tab-pane fade in active">
							<div class="row">
								<div class="col-md-12">
									<p>@Model.ProductItems.Product.Description</p>
								</div>
							</div>
						</div>
						<!-- /tab1  -->
						<!-- tab2  -->
						<div id="tab2" class="tab-pane fade in">
							<div class="row">
								<div class="col-md-12">
									<p>@Model.ProductItems.Product.Description</p>
								</div>
							</div>
						</div>
						<!-- /tab2  -->
						<!-- tab3  -->
						<div id="tab3" class="tab-pane fade in">
							<div class="row">
								<!-- Rating -->
								<div class="col-md-3">
									<div id="rating">
										<div class="rating-avg">
											<span>4.5</span>
											<div class="rating-stars">
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star-o"></i>
											</div>
										</div>
										<ul class="rating">
											<li>
												<div class="rating-stars">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
												</div>
												<div class="rating-progress">
													<div style="width: 80%;"></div>
												</div>
												<span class="sum">3</span>
											</li>
											<li>
												<div class="rating-stars">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star-o"></i>
												</div>
												<div class="rating-progress">
													<div style="width: 60%;"></div>
												</div>
												<span class="sum">2</span>
											</li>
											<li>
												<div class="rating-stars">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
												</div>
												<div class="rating-progress">
													<div></div>
												</div>
												<span class="sum">0</span>
											</li>
											<li>
												<div class="rating-stars">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
												</div>
												<div class="rating-progress">
													<div></div>
												</div>
												<span class="sum">0</span>
											</li>
											<li>
												<div class="rating-stars">
													<i class="fa fa-star"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
													<i class="fa fa-star-o"></i>
												</div>
												<div class="rating-progress">
													<div></div>
												</div>
												<span class="sum">0</span>
											</li>
										</ul>
									</div>
								</div>
								<!-- /Rating -->
								<!-- Reviews -->
								<div class="col-md-6">
									<div id="reviews">
										<ul class="reviews">
											<li>
												<div class="review-heading">
													<h5 class="name">John</h5>
													<p class="date">27 DEC 2018, 8:0 PM</p>
													<div class="review-rating">
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star-o empty"></i>
													</div>
												</div>
												<div class="review-body">
													<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</p>
												</div>
											</li>
											<li>
												<div class="review-heading">
													<h5 class="name">John</h5>
													<p class="date">27 DEC 2018, 8:0 PM</p>
													<div class="review-rating">
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star-o empty"></i>
													</div>
												</div>
												<div class="review-body">
													<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</p>
												</div>
											</li>
											<li>
												<div class="review-heading">
													<h5 class="name">John</h5>
													<p class="date">27 DEC 2018, 8:0 PM</p>
													<div class="review-rating">
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star"></i>
														<i class="fa fa-star-o empty"></i>
													</div>
												</div>
												<div class="review-body">
													<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</p>
												</div>
											</li>
										</ul>
										<ul class="reviews-pagination">
											<li class="active">1</li>
											<li><a href="#">2</a></li>
											<li><a href="#">3</a></li>
											<li><a href="#">4</a></li>
											<li><a href="#"><i class="fa fa-angle-right"></i></a></li>
										</ul>
									</div>
								</div>
								<!-- /Reviews -->
								<!-- Review Form -->
								<div class="col-md-3">
									<div id="review-form">
										<form asp-controller="Comments" asp-action="Create" method="post">
											<input type="hidden" name="ProductId" value="@Model.ProductItems.Product.ProductId" />
											<textarea name="Detail" class="input" placeholder="Your Review"></textarea>
											<button type="submit" class="btn">Post Comment</button>
										</form>
										@foreach (var comment in Model.ProductItems.Product.ProductComments)
										{
											<div>
												<p>@comment.Detail</p>
												<p>@comment.Name</p>
												<p>@comment.CreateDate</p>
											</div>
										}
									@* 	<form class="review-form">
											<textarea class="input" placeholder="Your Review"></textarea>
											<div class="input-rating">
												<span>Your Rating: </span>
												<div class="stars">
													<input id="star5" name="rating" value="5" type="radio"><label for="star5"></label>
													<input id="star4" name="rating" value="4" type="radio"><label for="star4"></label>
													<input id="star3" name="rating" value="3" type="radio"><label for="star3"></label>
													<input id="star2" name="rating" value="2" type="radio"><label for="star2"></label>
													<input id="star1" name="rating" value="1" type="radio"><label for="star1"></label>
												</div>
											</div>
											<button class="primary-btn">Submit</button>
										</form> *@
									</div>
								</div>
								<!-- /Review Form -->
							</div>
						</div>
						<!-- /tab3  -->
					</div>
					<!-- /product tab content  -->
				</div>
			</div>
			<!-- /product tab -->
		</div>
		<!-- /row -->
	</div>
	<!-- /container -->
</div>

<!-- Section -->
<div class="section">
	<!-- container -->
	<div class="container">
		<!-- row -->
		<div class="row">
			<div class="col-md-12">
				<div class="section-title text-center">
					<h3 class="title">CÁC CẤU HÌNH KHÁC</h3>
				</div>
			</div>

			<!-- product -->
			@foreach (var item in ListSP)
			{
				<div class="col-md-3 col-xs-6">
					<a href="@Url.Action("XemChiTiet", "ProductView", new { id = item.ProductVarId} )">
						<div class="product">
							<div class="product-img">
								<img src="~/Contents/img/@item.ProductItems.Image1" alt="">
								<div class="product-label">
									<span class="sale">-30%</span>
								</div>
							</div>
							<div class="product-body">
								<p class="product-category">@item.ProductItems.Product.Category.CategoryName.ToUpper()</p>
								<h3 class="product-name"><a href="#">@item.ProductItems.Product.ProductName.ToUpper()  @item.Ram.RamName.ToUpper() @item.Ssd.Ssdname</a></h3>
								<h4 class="product-price">@item.Price <del class="product-old-price">@item.OriginPrice</del></h4>
								<div class="product-rating">
								</div>
								<div class="product-btns">
									<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
									<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
									<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
								</div>
							</div>
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
							</div>
						</div>
				</div>
			}

			<!-- /product -->

		</div>
		<!-- /row -->
	</div>
	<!-- /container -->
</div>
<!-- /Section -->

@section Scripts
{
	<script>
		var productId = '@Model.ProductItems.Product.ProductId';

		$(document).ready(function () {
			GetColor(productId);
		});
		// $('#colorId').change(function () {
		// 	var url = "/post/name-" + $(this).val();
		// 	window.location.href = url;
		// });

		$(document).on('change', '#colorId', function () {

			var colorIds = $(this).val();
			GetImages(colorIds)
			// var selectedRam = @Model.RamId;
			// var selectedSSD = @Model.Ssdid;
			// var selectedColor = $(this).val();
			
			// var url = '@Url.Action("XemChiTiet", "ProductView")'
			// 	+ `?id=${selectedColor}&ramId=${selectedRam}&ssdId=${selectedSSD}`;

			// window.location.href = url;
		});





		function GetColor(productId) {
			var product = productId;
			$.ajax({
				url: '@Url.Action("GetColor", "ProductView")',
				type: 'GET',
				data: { id: product },
				success: function (data) {
					var addedValues = {};
					var currentSelection = $('#colorId').val();
					$('#colorId').empty(); // Xóa tất cả các tùy chọn hiện có trước khi thêm mới
					$.each(data["$values"], function (index, item) {
						if (!addedValues[item.color.colorName]) {
							$('#colorId').append('<option value="' + item.productItemsId + '">' + item.color.colorName + '</option>');
							addedValues[item.color.colorName] = true;
						}
					});
					if (currentSelection && addedValues[currentSelection]) {
						$('#colorId').val(currentSelection);
					}
			
				}
			});
		}

		function GetImages(productId) {
			$.ajax({
				url: '@Url.Action("GetImages", "ProductView")',
				type: 'GET',
				data: { id: productId },
				success: function (data) {



					var images = [
						data.image1,
						data.image2,
						data.image3,
						data.image4
					];


					var imageNodes = document.querySelectorAll('#product-main-img .product-preview img');
					console.log("Hello" + imageNodes.length);

					for (var i = 0; i < imageNodes.length; i++) {
						if (images[i]) {
							imageNodes[i].src = '/Contents/img/' + images[i].split('/').pop();
						}
					}
					var imageNodes2 = document.querySelectorAll('.zoomImg');

					for (var i = 0; i < imageNodes2.length; i++) {
						if (images[i]) {
							imageNodes2[i].src = 'https://localhost:7266/Contents/img/' + images[i];
						}
					}
					var imageNodes3 = document.querySelectorAll('#product-imgs .product-preview img');

					for (var i = 0; i < imageNodes3.length; i++) {
						if (images[i]) {
							imageNodes3[i].src = '/Contents/img/' + images[i].split('/').pop();
						}
					}

				}
			})
		}

	

		$('.add-to-cart-btn').click(function (e) {
			var productId = $('#colorId').val();
			var quanTity = $('#quantityInput').val();
			var ram = @Model.RamId;
			var ssd = @Model.Ssdid;
			var returnUrl = "@currentUrl";

			$.ajax({
				url: '@Url.Action("ThemGioHang","ShoppingCart")',
				type: "GET", // Hoặc "POST", tuỳ vào cấu hình của controller
				data: {
					masp: productId,
					ramId: ram,
					ssdId : ssd,
					quantity: quanTity,
					strURL: returnUrl
				},
				success: function (response) {
					// Xử lý sau khi gửi thành công
					alert("Product added to cart successfully!");
				},
				error: function () {
					// Xử lý lỗi
					alert("Vượt quá số lượng tồn!");
				}
			});
		});

		$('#unique-item-qty-up').click(function () {

			var currentValue = parseInt($("#quantityInput").val());
			var qtyInStock = parseInt($(".product-options .input").text());

			if (currentValue < qtyInStock) {
				currentValue = currentValue + 1;
				$('#quantityInput').val(currentValue);
			} 
			else {
				alert("Số lượng vượt quá số lượng trong kho!");
			}
		});

		$('.qty-down').click(function () {

			var currentValue = parseInt($("#quantityInput").val());
			var newValue = currentValue--;
			$('#quantityInput').val(newValue);
		});
		
		

	</script>
}
	


