@using Microsoft.AspNetCore.Http.Extensions
@using Microsoft.AspNetCore.Identity
@using System.Security.Claims
@model IEnumerable<Product>
@inject LaptopContext _context
@inject UserManager<AppUserModel> _user
@{
	ViewData["Title"] = "LoaiProduct";
	Layout = "~/Views/Layout/_CategoryLayout.cshtml";
}
@{
	string currentUrl = Context.Request.GetDisplayUrl();
	string? userId = null;
	@if (User.Identity.IsAuthenticated)
	{
		userId = User.FindFirst(ClaimTypes.NameIdentifier).Value;
	}
}

<!-- SECTION -->
<div class="section">
	<!-- container -->
	<div class="container">
		<!-- row -->
		<div class="row">
			<!-- ASIDE -->
			<div id="aside" class="col-md-3">
				<!-- aside Widget -->
				<div class="aside">
					<h3 class="aside-title">Categories</h3>
					<div class="checkbox-filter">

						<div class="input-checkbox">
							<input type="checkbox" id="category-1">
							<label for="category-1">
								<span></span>
								Laptops
								<small>(120)</small>
							</label>
						</div>

						<div class="input-checkbox">
							<input type="checkbox" id="category-2">
							<label for="category-2">
								<span></span>
								Smartphones
								<small>(740)</small>
							</label>
						</div>

						<div class="input-checkbox">
							<input type="checkbox" id="category-3">
							<label for="category-3">
								<span></span>
								Cameras
								<small>(1450)</small>
							</label>
						</div>

						<div class="input-checkbox">
							<input type="checkbox" id="category-4">
							<label for="category-4">
								<span></span>
								Accessories
								<small>(578)</small>
							</label>
						</div>

						<div class="input-checkbox">
							<input type="checkbox" id="category-5">
							<label for="category-5">
								<span></span>
								Laptops
								<small>(120)</small>
							</label>
						</div>

						<div class="input-checkbox">
							<input type="checkbox" id="category-6">
							<label for="category-6">
								<span></span>
								Smartphones
								<small>(740)</small>
							</label>
						</div>
					</div>
				</div>
				<!-- /aside Widget -->
				<!-- aside Widget -->
				<div class="aside">
					<h3 class="aside-title">Price</h3>
					<div class="price-filter">
						<div id="price-slider"></div>
						<div class="input-number price-min">
							<input id="price-min" type="number">
							<span class="">+</span>
							<span class="qty-down">-</span>
						</div>
						<span>-</span>
						<div class="input-number price-max">
							<input id="price-max" type="number">
							<span class="qty-up-sd">+</span>
							<span class="qty-down-sd">-</span>
						</div>
					</div>
				</div>
				<!-- /aside Widget -->
				<!-- aside Widget -->
				<div class="aside">
					<h3 class="aside-title">Brand</h3>
					<div class="checkbox-filter">
						<div class="input-checkbox">
							<input type="checkbox" id="brand-1">
							<label for="brand-1">
								<span></span>
								SAMSUNG
								<small>(578)</small>
							</label>
						</div>
						<div class="input-checkbox">
							<input type="checkbox" id="brand-2">
							<label for="brand-2">
								<span></span>
								LG
								<small>(125)</small>
							</label>
						</div>
						<div class="input-checkbox">
							<input type="checkbox" id="brand-3">
							<label for="brand-3">
								<span></span>
								SONY
								<small>(755)</small>
							</label>
						</div>
						<div class="input-checkbox">
							<input type="checkbox" id="brand-4">
							<label for="brand-4">
								<span></span>
								SAMSUNG
								<small>(578)</small>
							</label>
						</div>
						<div class="input-checkbox">
							<input type="checkbox" id="brand-5">
							<label for="brand-5">
								<span></span>
								LG
								<small>(125)</small>
							</label>
						</div>
						<div class="input-checkbox">
							<input type="checkbox" id="brand-6">
							<label for="brand-6">
								<span></span>
								SONY
								<small>(755)</small>
							</label>
						</div>
					</div>
				</div>
				<!-- /aside Widget -->
				<!-- aside Widget -->
				
				<!-- /aside Widget -->
			</div>
			<!-- /ASIDE -->
			<!-- STORE -->
			<div id="store" class="col-md-9">
				<!-- store top filter -->
				<div class="store-filter clearfix">
					<div class="store-sort">
						<label>
							Sort By:
							<select class="input-select">
								<option value="0">Popular</option>
								<option value="1">Position</option>
							</select>
						</label>

						<label>
							Show:
							<select class="input-select">
								<option value="0">20</option>
								<option value="1">50</option>
							</select>
						</label>
					</div>
					<ul class="store-grid">
						<li class="active"><i class="fa fa-th"></i></li>
						<li><a href="#"><i class="fa fa-th-list"></i></a></li>
					</ul>
				</div>
				<!-- /store top filter -->
				<!-- store products -->
				<div class="row">
					<!-- product -->
					@foreach (var item in Model.Take(6))
					{
						var productId = item.ProductItems.FirstOrDefault()?.ProductVariations.FirstOrDefault();
						var customerId = _context.Customers.Where(n => n.AccountId == userId).Select(n => n.CustomerId).FirstOrDefault();
						if (customerId == 0)
						{
							customerId = _context.Employees.Where(n => n.AccountId == userId).Select(n => n.EmployeeId).FirstOrDefault();
						}
						<div class="col-md-4 col-xs-6">
							<div class="product">
								<a href="/post/@SlugGenerator.SlugGenerator.GenerateSlug(item.ProductName)-@item.ProductItems.FirstOrDefault()?.ProductVariations.FirstOrDefault()?.ProductVarId" />
								<div class="product-img">
									<img src="~/Contents/img/@item.ProductItems.FirstOrDefault()?.Image1" alt="">
									<div class="product-label">
										<span class="sale">-30%</span>
										<span class="new">NEW</span>
									</div>
								</div>
								<div class="product-body">
									<p class="product-category">@item.Category?.CategoryName</p>
									<h3 class="product-name"><a href="#">@item.ProductName @item.ProductItems.First()?.ProductVariations.First()?.Ram?.RamName?.ToUpper() @item.ProductItems.First().ProductVariations.First().Ssd.Ssdname</a></h3>
									<h4 class="product-price">@item.ProductItems.FirstOrDefault()?.ProductVariations.FirstOrDefault()?.Price.ToString("#,##0") VNĐ <del class="product-old-price">@item.ProductItems.FirstOrDefault()?.ProductVariations.FirstOrDefault()?.OriginPrice</del></h4>
									<div class="product-rating">
										<i class="fa fa-star"></i>
										<i class="fa fa-star"></i>
										<i class="fa fa-star"></i>
										<i class="fa fa-star"></i>
										<i class="fa fa-star"></i>
									</div>
									<div class="product-btns">
										@if (productId != null && customerId != 0)
										{
											var wish = _context.WishLists.FirstOrDefault(n => n.ProductId == productId.ProductVarId && n.CustomerId == customerId);

											if (wish != null)
											{
												<button id="wishlist-button" data-product-id="@productId.ProductVarId" style="color : red;" class="add-to-wishlist">
													<i class="fa fa-heart" style="display: none; display : inline;"></i><span class="tooltipp">add to wishlist</span>
												</button>
											}
											else
											{
												<button id="wishlist-button" data-product-id="@productId.ProductVarId" class="add-to-wishlist">
													<i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span>
												</button>
											}


										}
										<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
									</div>
								</div>
							</div>
						</div>
					}
					<!-- /product -->
				</div>
				<!-- /store products -->
				<!-- store bottom filter -->
				<div class="store-filter clearfix">
					<span class="store-qty">Showing 20-100 products</span>
					<ul class="store-pagination">
						<li class="active">1</li>
						<li><a href="#">2</a></li>
						<li><a href="#">3</a></li>
						<li><a href="#">4</a></li>
						<li><a href="#"><i class="fa fa-angle-right"></i></a></li>
					</ul>
				</div>
				<!-- /store bottom filter -->
			</div>
			<!-- /STORE -->
		</div>
		<!-- /row -->
	</div>
	<!-- /container -->
</div>
<!-- /SECTION -->

<style>
	.add-to-wishlist.active {
		color: red; /* Màu sắc hoặc bất kỳ thay đổi nào bạn muốn khi button được active */
	}

	.add-to-wishlist .fa.fa-heart {
		display: none; /* Ẩn icon trái tim rỗng */
	}

	.add-to-wishlist.active .fa.fa-heart-o {
		display: none; /* Ẩn icon trái tim rỗng khi active */
	}

	.add-to-wishlist.active .fa.fa-heart {
		display: inline; /* Hiện icon trái tim đầy khi active */
	}

</style>


<script>

	document.querySelectorAll('.add-to-wishlist').forEach(function (button) {
		button.addEventListener('click', function () {

			this.classList.toggle('active');

			const icon = this.querySelector('i');
			if (this.classList.contains('active')) {
				icon.classList.remove('fa-heart-o');
				icon.classList.add('fa-heart');

				var productId = this.getAttribute('data-product-id');
				addWishlist(productId);

			} else {
				icon.classList.remove('fa-heart');
				icon.classList.add('fa-heart-o');

				var productId = this.getAttribute('data-product-id');
				removeWishlist(productId);
			}
		});
	});


	function addWishlist(productId) {
		$.ajax({
			type: 'POST',
			url: '@Url.Action("AddWishList", "ProductView")',
			data: { id: productId },
			success: function (data) {

			},
		});
	}

	function removeWishlist(productId) {
		$.ajax({
			type: 'POST',
			url: '@Url.Action("RemoveWishList", "ProductView")',
			data: { id: productId },
			success: function (data) {

			},
		});
	}

</script>
